<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<title>Eliminar Apuesta</title>
		<link rel="stylesheet" type="text/css" href="delete_index.css">
	</head>
	<body>
		<div class="container">
			<h1>Eliminar Apuesta</h1>
			<?php
$host = "proyectoseguridad-db-1";
$usuario = "admin";
$clave = "test";
$bd = "database";

$conn = new mysqli($host, $usuario, $clave, $bd);

if ($conn->connect_error) {
    die("Error de conexión: " . $conn->connect_error);
}

// --- Construir la consulta directamente (INSEGURO) ---
$sql = "
    SELECT
        ce.nombre AS nombre_cerdo,
        ca.nombre AS nombre_carrera,
        ca.fecha AS fecha_carrera,
        ap.cantidad AS cantidad_apostada,
        ap.id AS id_apuesta,
        ap.cerdo AS id_cerdo,
        ap.idCarrera AS id_carrera
    FROM
        apuesta ap
    JOIN cerdo ce ON ap.cerdo = ce.id
    JOIN carrera ca ON ap.idCarrera = ca.id
    WHERE
        ap.idUs = (SELECT id FROM usuarios WHERE email = '" . $conn->real_escape_string($_GET['user']) . "')
";

$result = $conn->query($sql);

if ($result === false) {
    echo "Error en la consulta: " . $conn->error;
} else {

    while ($row = $result->fetch_assoc()) {
        echo "<strong> Apuesta número " . $row['id_apuesta'] . "</strong><br>";
        echo "Cerdo número " . $row['id_cerdo'] . ": " . $row['nombre_cerdo'] . "<br>";
        echo "Carrera número " . $row['id_carrera'] . ": " . $row['nombre_carrera'] . "<br>";
        echo "Fecha: " . $row['fecha_carrera'] . "<br>";
        echo "Cantidad apostada: " . $row['cantidad_apostada'] . "<br><br>";
        $contador++; // Incrementa el contador
    }
}

$conn->close();
echo "</div>";
$email=$_GET["user"];
echo "<form id='delete_form' action='procesar_borrado.php?user=$email' method='POST'>";
?>
		</div>
	<form id="delete_form" action="procesar_borrado.php" method="POST">
      <input type="hidden" name="user" value="<?= htmlspecialchars($email) ?>">


      <label for="idApuesta">Id Apuesta</label>
      <input type="number" id="idApuesta" name="idApuesta" required />


      <button id="item_delete_summit" type="submit">Borrar apuesta</button>
    </form>	
	</body>
</html>
