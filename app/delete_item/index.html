<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<title>Los MontaMarcos - Borrar apuestas</title>
		<link rel="stylesheet" type="text/css" href="delete_index.css">
	</head>
	  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .fila {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        width: 1100px;
    }
    .container {
      text-align: center;
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h1 {
      margin-bottom: 30px;
    }
    button {
      display: block;
      margin: 15px auto;
      background: #4CAF50;
      color: white;
      padding: 16px 40px;
      border-radius: 5px;
      font-size: 18px;
      border: none;
      cursor: pointer;
      width: fit-content;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #45a049;
    }
    input {
      display: block;
      margin: 15px auto;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 5px;
      border: 1.5px solid #4CAF50;
      width: 300px;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.3s ease;
    }
    input:focus {
      border-color: #388E3C;
      box-shadow: 0 0 5px #4CAF50;
    }

    .volver-container {
      position: absolute;
      top: 10px;
      right: 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-family: Arial, sans-serif;
      font-size: 16px;
      color: #333;
      gap: 5px;
    }

    .volver-container a {
      background: #4CAF50;
      color: white;
      padding: 8px 16px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      transition: background 0.3s ease;
    }

    .volver-container a:hover {
      background: #45a049;
    }
  </style>
	<body>
		<div class="container">
			<h1>Mis apuestas</h1>
			<?php
$host = "proyectoseguridad-db-1";
$usuario = "admin";
$clave = "test";
$bd = "database";

$conn = new mysqli($host, $usuario, $clave, $bd);

if ($conn->connect_error) {
    die("Error de conexión: " . $conn->connect_error);
}

// --- Construir la consulta directamente (INSEGURO) ---
$sql = "
    SELECT
        ce.nombre AS nombre_cerdo,
        ca.nombre AS nombre_carrera,
        ca.fecha AS fecha_carrera,
        ap.cantidad AS cantidad_apostada,
        ap.id AS id_apuesta,
        ap.cerdo AS id_cerdo,
        ap.idCarrera AS id_carrera
    FROM
        apuesta ap
    JOIN cerdo ce ON ap.cerdo = ce.id
    JOIN carrera ca ON ap.idCarrera = ca.id
    JOIN usuarios us ON ap.idUs = us.id
	WHERE
        ap.idUs = (SELECT id FROM usuarios WHERE email = '" . $conn->real_escape_string($_GET['user']) . "')
    ORDER BY ap.idCarrera ASC
";

$result = $conn->query($sql);

if ($result === false) {
    echo "Error en la consulta: " . $conn->error;
} else {
    echo "<div class='fila'>";
    while ($row = $result->fetch_assoc()) {
        echo "<div class='container'>";
        echo "<h3><strong> Apuesta número " . $row['id_apuesta'] . "</strong></h3>";
        echo "Cerdo número " . $row['id_cerdo'] . ": " . $row['nombre_cerdo'] . "<br>";
        echo "Carrera número " . $row['id_carrera'] . ": " . $row['nombre_carrera'] . "<br>";
        echo "Fecha: " . $row['fecha_carrera'] . "<br>";
        echo "Cantidad apostada: " . $row['cantidad_apostada'] . "<br><br>";
        echo "</div>";
    }
}


$conn->close();
echo "</div>";
$email=$_GET["user"];
echo "<form id='delete_form' action='procesar_borrado.php?user=$email' method='POST'>";
?>
  </div>
   &nbsp; &nbsp; &nbsp;
  <div class="container">
    <h1>Borrar una apuesta</h1>
	<form id="delete_form" action="procesar_borrado.php" method="POST">
      <input type="hidden" name="user" value="<?= htmlspecialchars($email) ?>">


      <label for="idApuesta">Id Apuesta:</label>
      <input type="number" id="idApuesta" name="idApuesta" required />


      <button id="item_delete_summit" type="submit">Eliminar</button>
    </form>	

  <div class="volver-container">
    <?php
    echo "<a href=" . "/items/items.php?user=" . urlencode($email) . ">Volver</a>";
    ?>
  </div>
	</body>

</html>
