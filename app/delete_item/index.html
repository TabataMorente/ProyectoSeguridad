<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<title>Los MontaMarcos - Borrar apuestas</title>
		<link rel="stylesheet" type="text/css" href="delete_index.css">
	</head>
	  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      margin: 0;
      padding: 40px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .fila {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start; /* ðŸ”¹ Evita que se centren verticalmente */
      gap: 20px;
      width: 1100px;
    }

    .container {
      text-align: center;
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      flex: 0 0 400px; /* ðŸ”¹ TamaÃ±o fijo opcional para evitar saltos */
      box-sizing: border-box;
    }

    h1 {
      margin-bottom: 30px;
    }

    button {
      display: block;
      margin: 15px auto;
      background: #ff0000;
      color: white;
      padding: 16px 40px;
      border-radius: 5px;
      font-size: 18px;
      border: none;
      cursor: pointer;
      width: fit-content;
      font-weight: bold;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #45a049;
    }

    input {
      display: block;
      margin: 15px auto;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 5px;
      border: 1.5px solid #4CAF50;
      width: 300px;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.3s ease;
    }

    input:focus {
      border-color: #388E3C;
      box-shadow: 0 0 5px #4CAF50;
    }

    .volver-container {
      position: fixed; /* ðŸ”¹ Fijo en pantalla */
      top: 10px;
      right: 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-family: Arial, sans-serif;
      font-size: 16px;
      color: #333;
      gap: 5px;
    }

    .volver-container a {
      background: #4CAF50;
      color: white;
      padding: 8px 16px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      transition: background 0.3s ease;
    }

    .volver-container a:hover {
      background: #45a049;
    }

  </style>
	<body>
		<div class="container">
			<h1>Mis apuestas</h1>
			<?php
$email=$_GET["user"];
$host = "proyectoseguridad-db-1";
$usuario = "admin";
$clave = "test";
$bd = "database";

$conn = new mysqli($host, $usuario, $clave, $bd);

if ($conn->connect_error) {
    die("Error de conexiÃ³n: " . $conn->connect_error);
}

// --- Construir la consulta directamente (INSEGURO) ---
$sql = "
    SELECT
        ce.nombre AS nombre_cerdo,
        ca.nombre AS nombre_carrera,
        ca.fecha AS fecha_carrera,
        ap.cantidad AS cantidad_apostada,
        ap.id AS id_apuesta,
        ap.cerdo AS id_cerdo,
        ap.idCarrera AS id_carrera,
        us.nombre AS nombre_usuario
    FROM
        apuesta ap
    JOIN cerdo ce ON ap.cerdo = ce.id
    JOIN carrera ca ON ap.idCarrera = ca.id
    JOIN usuarios us ON ap.idUs = us.id
	WHERE
        ap.idUs = (SELECT id FROM usuarios WHERE email = '" . $conn->real_escape_string($_GET['user']) . "')
    ORDER BY ap.idCarrera ASC
";

$result = $conn->query($sql);

if ($result === false) {
    echo "Error en la consulta: " . $conn->error;
} else {
    echo "<div class='fila'>";
    if ($result->num_rows === 0) {
    echo "<p style='text-align:center; font-family:Arial; font-size:18px; color:#555; margin-top:50px;'>
            No tienes apuestas registradas actualmente.
          </p>";
    }
    else{
      while ($row = $result->fetch_assoc()) {
        echo "<div class='container'>";
        echo "<h3><strong> Apuesta nÃºmero " . htmlspecialchars($row['id_apuesta']) . "</strong></h3>";
        echo "Usuario: " . htmlspecialchars($row['nombre_usuario']) . "<br>";
        echo "Cerdo: " . htmlspecialchars($row['nombre_cerdo']) . "<br>";
        echo "Carrera: " . htmlspecialchars($row['nombre_carrera']) . "<br>";
        echo "Fecha: " . htmlspecialchars($row['fecha_carrera']) . "<br>";
        echo "Cantidad apostada: " . htmlspecialchars($row['cantidad_apostada']) . "<br><br>";

        // Formulario de eliminaciÃ³n
        echo "<form class='delete_form' action='procesar_borrado.php' method='POST'>";
        echo "<input type='hidden' name='user' value='" . htmlspecialchars($email) . "'>";
        echo "<input type='hidden' name='id' value='" . htmlspecialchars($row['id_apuesta']) . "'>";
        echo "<button type='submit'>Eliminar</button>";
        echo "</form>";

        echo "</div>";
      }
    }
}


$conn->close();
echo "</div>";
echo "<form id='delete_form' action='procesar_borrado.php?user=$email' method='POST'>";
?>
  <div class="volver-container">
    <?php
    echo "<a href=" . "/items/items.php?user=" . urlencode($email) . ">Volver</a>";
    ?>
  </div>
	</body>

</html>
